---
import {
	convertTitle,
	getConcerts,
	getDisques,
	getEditeur,
	getOeuvre,
	getPath,
} from "../../helpers";
import Field from "../Field.astro";
const { id } = Astro.props;
const oeuvre = getOeuvre(id);
const {
	date_comp,
	opus,
	titre,
	editeur,
	commentaire,
	formation,
	texte,
	creation,
	duree,
} = oeuvre;

const concerts = getConcerts().filter((concert) =>
	concert.oeuvres?.includes(titre),
);

const disques = getDisques().filter((disque) =>
	disque.oeuvres?.includes(titre),
);

const editeurItem = editeur && getEditeur(convertTitle(editeur));
---

<div>
	<div>
		<h3>
			<a href={getPath(oeuvre)}>{titre}</a>
		</h3>
		<h4>Opus</h4>
		<p>{opus}</p>
		{
			editeurItem && (
				<>
					<h4>Éditeur</h4>
					<p>
						<a href={getPath(editeurItem)}>{editeur}</a>
					</p>
				</>
			)
		}
		<Field label="Formation" value={formation} />
		<Field label="Composé En" value={date_comp} />
		<Field label="Texte" value={texte} />
		<Field label="Création" value={creation} />
		<Field label="Durée" value={duree} />

		{
			concerts && concerts.length > 0 && (
				<div>
					<h4>Concerts</h4>
					{concerts.map((concert) => {
						return (
							<li>
								<a href={getPath(concert)}>{concert.titre}</a>
							</li>
						);
					})}
				</div>
			)
		}
		{
			disques && disques.length > 0 && (
				<div>
					<h4>Disques</h4>
					{disques.map((disque) => {
						return (
							<li>
								<a href={getPath(disque)}>{disque.titre}</a>
							</li>
						);
					})}
				</div>
			)
		}
		<div set:html={commentaire} />
	</div>
</div>
