---
import Oeuvre from "../../components/catalogue/oeuvre/Oeuvre.compact.astro";
import { getItemsByYear, getString } from "../../content";
import Layout from "../../layouts/Layout.astro";
import Instruments from "../../components/catalogue/Instruments.astro";
import Categories from "../../components/catalogue/Categories.astro";
import SubgridLayout from "../../components/layouts/SubgridLayout.astro";
import PageLayout from "../../components/layouts/PageLayout.astro";
import type { OeuvreWithId } from "../../types";
import Editeurs from "../../components/catalogue/Editeurs.astro";
import Search from "../../components/catalogue/Search.astro";
import { getCatalogue } from "../../content";
import { pluralize } from "../../helpers";

const catalogue = getCatalogue();
const catalogueByYear = getItemsByYear<OeuvreWithId>(catalogue);
---

<script src="../../scripts/search.ts"></script>

<Layout title={getString("catalogue")?.t}>
	<PageLayout sectionId="catalogue" hasSidebar={true}>
		<h2
			slot="page-heading"
			style={`view-transition-name: heading-catalogue`}
		>
			Catalogue
			<span class="heading-metadata"
				>({catalogue.length}
				{pluralize("oeuvre", catalogue.length)})</span
			>
		</h2>
		{
			catalogueByYear.map(({ year, items }) => {
				return (
					<SubgridLayout
						className="catalogue-year"
						slot="page-content"
					>
						<h4 class="year-title" slot="col1">
							<span>{year}</span>
						</h4>
						<div class="feed-items" slot="main">
							{items.map((oeuvre) => (
								<Oeuvre id={oeuvre.id} />
							))}
						</div>
					</SubgridLayout>
				);
			})
		}
		<Search slot="page-sidebar" />
		<Categories slot="page-sidebar" />
		<Instruments slot="page-sidebar" />
		<Editeurs slot="page-sidebar" />
	</PageLayout>
</Layout>
